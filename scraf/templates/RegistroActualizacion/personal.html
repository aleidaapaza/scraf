{% extends 'base/base.html' %}
{% load static %}
{% block contenido %}

<style>
  /* Aislar estilos a esta vista */
  .registro-personal .card { border-radius: 14px; }
  .registro-personal .card-header { border-bottom: 0; }
  .registro-personal .title-green { color:#0b5d33; }           /* verde oscuro */
  .registro-personal .bg-green-soft { background:#d7f4dc; }    /* verde pastel fondo */
  /* Switch Bootstrap 5 coloreado en verde oscuro */
  .registro-personal .form-check-input:checked {
    background-color:#0b5d33;
    border-color:#0b5d33;
  }
  .registro-personal .form-check-input:focus {
    box-shadow:0 0 0 .2rem rgba(11,93,51,.25);
    border-color:#0b5d33;
  }
</style>

<div class="container-fluid registro-personal">
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <!-- TÍTULO -->
    <div class="row mt-3">
      <div class="col-12">
        <h2 class="fw-bold text-white">REGISTRAR PERSONAL</h3>
        <hr class="mt-2">
      </div>
    </div>
    <!-- FILA: DATOS PERSONALES -->
    <div class="row justify-content-center">
      <div class="col-12 col-lg-10">
        <div class="card shadow-sm">
          <div class="card-header bg-white text-center">
            <h5 class="m-0 fw-bold title-green">DATOS PERSONALES</h5>
          </div>
          {% for field in form %}
            {% if field.help_text %}
              <div class="form-text text-warning text-muted small">
                {{ field.help_text }}
              </div>
            {% endif %}
            {% if field.errors %}
              <div class="text-danger small mt-1">
              {% for error in field.errors %}
                {# Excluir errores que contengan "obligatorio" #}
                {% if "obligatorio" not in error|lower %}
                  <span>{{ error }}</span><br>
                {% endif %}
              {% endfor %}
              </div>
            {% endif %}
          {% endfor %}
          <div class="card-body row">
                <label class="col-md-2 col-form-label fw-semibold text-sm-end">{{ form.nombre.label_tag }}</label>
                <div class="col-md-4">{{  form.nombre }}</div>
                <label class="col-md-2 col-form-label fw-semibold text-sm-end">{{ form.apellido.label_tag }}</label>
                <div class="col-md-4">{{  form.apellido }}</div>
                <label class="col-md-2 col-form-label fw-semibold text-sm-end">{{ form.cargo.label_tag }}</label>
                <div class="col-md-10">{{  form.cargo }}</div>
                <label class="col-md-2 col-form-label fw-semibold text-sm-end">{{ form.contacto.label_tag }}</label>
                <div class="col-md-4">{{  form.contacto }}</div>
                <label class="col-md-2 col-form-label fw-semibold text-sm-end">{{ form.carnet.label_tag }}</label>
                <div class="col-md-4">{{  form.carnet }}</div>
                <label class="col-md-2 col-form-label fw-semibold text-sm-end">{{ form.rubrica.label_tag }}</label>
                <div class="col-md-4">{{  form.rubrica }}</div>
          </div>
        </div>
      </div>
    </div>
    <!-- FILA 1-10-1: USUARIO Y RESPONSABILIDADES -->
    <div class="row justify-content-center mt-4">
      <div class="col-12 col-lg-10">
        <div class="card shadow-sm bg-green-soft border-0">
          <div class="card-header bg-transparent text-center">
            <h5 class="m-0 fw-bold title-green">Tipo de Usuario y Responsabilidades</h5>
          </div>
          <div class="card-body">
            <!-- Usuario -->
            <div class="mb-3 row">
              <label class="col-sm-4 col-form-label fw-semibold text-sm-end">Nombre de usuario</label>
              <div class="col-sm-8">
                {{ form2.username }}  {# ajusta si tu campo se llama distinto #}
              </div>
            </div>

            <!-- Grupo A (exclusivo): Revisión -->
            <div class="row align-items-center gy-2 mt-2">
              <label class="col-sm-4 col-form-label fw-semibold text-sm-end">Encargado de revisión</label>
              <div class="col-sm-2">
                <div class="form-check form-switch">
                  <input class="form-check-input rev-switch" type="checkbox" id="rev_enc" value="encargado">
                </div>
              </div>
              <label class="col-sm-4 col-form-label fw-semibold text-sm-end">Apoyo de revisión</label>
              <div class="col-sm-2">
                <div class="form-check form-switch">
                  <input class="form-check-input rev-switch" type="checkbox" id="rev_apo" value="apoyo">
                </div>
              </div>
              <input type="hidden" name="rol_revision" id="rol_revision">
            </div>
            <hr>
            <!-- Grupo B (exclusivo): Permisos de activos -->
            <div class="row align-items-center gy-3">
              <label class="col-sm-6 col-lg-4 col-form-label fw-semibold text-sm-end">Gestión de Personal:</label>
              <div class="col-sm-6 col-lg-2">
                <div class="form-check form-switch">
                  <input class="form-check-input act-switch" type="checkbox" id="act_personal" value="personal">
                </div>
              </div>
              <label class="col-sm-6 col-lg-4 col-form-label fw-semibold text-sm-end">Gestión de Mantenimiento:</label>
              <div class="col-sm-6 col-lg-2">
                <div class="form-check form-switch">
                  <input class="form-check-input act-switch" type="checkbox" id="act_personal" value="personal">
                </div>
              </div>
              <hr>
              <label class="col-sm-6 col-lg-4 col-form-label fw-semibold text-sm-end">Gestión de Activos Fijos:</label>
              <div class="col-sm-6 col-lg-2">
                <div class="form-check form-switch">
                  <input class="form-check-input act-switch" type="checkbox" id="act_gestion" value="gestion_activos">
                </div>
              </div>
              <label class="col-sm-6 col-lg-4 col-form-label fw-semibold text-sm-end">Solo Visualiza los Activos Fijos:</label>
              <div class="col-sm-6 col-lg-2">
                <div class="form-check form-switch">
                  <input class="form-check-input act-switch" type="checkbox" id="act_view" value="solo_visualiza">
                </div>
              </div>
              <input type="hidden" name="rol_activos" id="rol_activos">
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- BOTÓN CENTRADO -->
    <div class="row mt-4">
      <div class="col-12 d-flex justify-content-center">
        <button type="submit" class="btn btn-success px-4 py-2">
          Registrar Personal
        </button>
      </div>
    </div>

  </form>
</div>

<script>
const revSwitches = document.querySelectorAll('.rev-switch');
  const rolRevisionInput = document.getElementById('rol_revision');

  revSwitches.forEach(chk => {
    chk.addEventListener('change', (e) => {
      if (e.target.checked) {
        // 1. Aplicar exclusividad (solo uno puede estar marcado)
        revSwitches.forEach(o => {
          if (o !== e.target) o.checked = false;
        });
        // 2. Escribir el valor ('encargado' o 'apoyo') en el campo oculto
        rolRevisionInput.value = e.target.value;
      } else {
        // Si el switch se desmarca, limpiar el campo oculto
        rolRevisionInput.value = '';
      }
    });
  });
  // Grupo B: sólo 1 de 3
// Grupo B: exclusividad solo entre 'personal' y 'solo_visualiza'
const exclusivosB = document.querySelectorAll('.act-switch[value="personal"], .act-switch[value="solo_visualiza"]');

exclusivosB.forEach(chk => {
  chk.addEventListener('change', (e) => {
    if (e.target.checked) {
      exclusivosB.forEach(o => { if (o !== e.target) o.checked = false; });
    }
  });
});

// Actualiza el hidden cuando cambia cualquiera de los 3
document.querySelectorAll('.act-switch').forEach(chk => {
  chk.addEventListener('change', (e) => {
    if (e.target.checked) {
      document.getElementById('rol_activos').value = e.target.value;  
    } else {
      // Si ninguno está marcado, limpiar el hidden
      const algunoMarcado = Array.from(document.querySelectorAll('.act-switch')).some(o => o.checked);
      if (!algunoMarcado) {
        document.getElementById('rol_activos').value = '';
      }
    }
  });
});

</script>

{% endblock %}
